<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hot Water System Commissioning</title>
    <link rel="stylesheet" href="../styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <img src="../assets/logo.png" alt="Company Logo" class="logo">
            <h1>Hot Water System Commissioning Report</h1>
        </header>

        <div class="form-container">
            <form id="commissioningForm">
                <!-- Client Information -->
                <div class="form-section">
                    <h2>Client Information</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="companyName">Company/Client Name</label>
                            <input type="text" id="companyName" required>
                        </div>
                        <div class="form-group">
                            <label for="invoiceNo">Invoice No</label>
                            <input type="text" id="invoiceNo" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="customerName">Signature person</label>
                            <input type="text" id="customerName" required>
                        </div>
                        <div class="form-group">
                            <label for="contactNo">Contact No</label>
                            <input type="tel" id="contactNo" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="address">Address</label>
                        <input type="text" id="address" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="commissionedBy">Commissioned by</label>
                            <input type="text" id="commissionedBy" required>
                        </div>
                        <div class="form-group">
                            <label for="commissioningDate">Commissioning Date</label>
                            <input type="date" id="commissioningDate" required>
                        </div>
                    </div>
                </div>

                <!-- Product Details -->
                <div class="form-section">
                    <h2>Product Details</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="model">Model</label>
                            <input type="text" id="model" required>
                        </div>
                        <div class="form-group">
                            <label for="capacity">Capacity</label>
                            <input type="text" id="capacity" required>
                        </div>
                        <div class="form-group">
                            <label for="serialNo">Serial No</label>
                            <input type="text" id="serialNo" required>
                        </div>
                    </div>
                </div>

                <!-- Installation Check List -->
                <div class="form-section">
                    <h2>Installation Check List</h2>
                    <div class="form-group">
                        <label>PRV Installed</label>
                        <div class="radio-group">
                            <label class="radio-option"><input type="radio" name="prv" value="Installed" required> Installed</label>
                            <label class="radio-option"><input type="radio" name="prv" value="Not installed"> Not installed</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>AIR VENT Installed</label>
                        <div class="radio-group">
                            <label class="radio-option"><input type="radio" name="airVent" value="Installed" required> Installed</label>
                            <label class="radio-option"><input type="radio" name="airVent" value="Not installed"> Not installed</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Placements/positioning</label>
                        <div class="radio-group">
                            <label class="radio-option"><input type="radio" name="placement" value="Correct" required> Correct</label>
                            <label class="radio-option"><input type="radio" name="placement" value="Not correct"> Not correct</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Plumbing as per Instructions</label>
                        <div class="radio-group">
                            <label class="radio-option"><input type="radio" name="plumbing" value="Correct" required> Correct</label>
                            <label class="radio-option"><input type="radio" name="plumbing" value="Not correct"> Not correct</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Pipe Insulation</label>
                        <div class="radio-group">
                            <label class="radio-option"><input type="radio" name="insulation" value="Done" required> Done</label>
                            <label class="radio-option"><input type="radio" name="insulation" value="Not done"> Not done</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Any leakage observed</label>
                        <div class="radio-group">
                            <label class="radio-option"><input type="radio" name="leakage" value="Yes" required> Yes</label>
                            <label class="radio-option"><input type="radio" name="leakage" value="No"> No</label>
                        </div>
                    </div>
                </div>

                <!-- Operation Check List -->
                <div class="form-section">
                    <h2>Operation Check List</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="waterPressure">Cold Water Pressure (bar)</label>
                            <input type="text" id="waterPressure" required>
                        </div>
                        <div class="form-group">
                            <label for="waterHardness">Hardness of Water (ppm)</label>
                            <input type="text" id="waterHardness" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="waterTemperature">Hot Water Temperature at Sample Point Nearest Outlet (Â°C)</label>
                        <input type="text" id="waterTemperature" required>
                    </div>
                </div>

                <!-- Observations -->
                <div class="form-section">
                    <h2>Observations and Recommendations</h2>
                    <div class="form-group">
                        <textarea id="observations"></textarea>
                    </div>
                </div>

                <!-- Signatures -->
                <div class="form-section">
                    <h2>Signatures</h2>
                    <div class="signature-container">
                        <div class="signature-box">
                            <h3>Customer/Representative Signature</h3>
                            <canvas id="customerSignature" class="signature-pad"></canvas>
                            <button type="button" class="clear-btn" onclick="clearSignature('customerSignature')">Clear Signature</button>
                        </div>
                        <div class="signature-box">
                            <h3>Service Engineer Signature</h3>
                            <canvas id="engineerSignature" class="signature-pad"></canvas>
                            <button type="button" class="clear-btn" onclick="clearSignature('engineerSignature')">Clear Signature</button>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button type="button" class="btn btn-primary" onclick="generatePDF()">Generate PDF</button>
                    <button type="button" class="btn btn-secondary" id="nextButton" disabled>Next</button>
                </div>
            </form>
        </div>
    </div>

    <script src="../scripts/generate-hws.js"></script>
    <script>
        // Set today's date as default
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('commissioningDate').value = today;
            
            // Initialize signature pads
            const customerCanvas = document.getElementById('customerSignature');
            const engineerCanvas = document.getElementById('engineerSignature');
            
            const customerSigPad = new SignaturePad(customerCanvas, {
                backgroundColor: 'rgb(255, 255, 255)',
                penColor: 'rgb(0, 0, 0)'
            });
            
            const engineerSigPad = new SignaturePad(engineerCanvas, {
                backgroundColor: 'rgb(255, 255, 255)',
                penColor: 'rgb(0, 0, 0)'
            });
            
            // Handle window resize
            function resizeCanvas() {
                const ratio = Math.max(window.devicePixelRatio || 1, 1);
                
                [customerCanvas, engineerCanvas].forEach(canvas => {
                    canvas.width = canvas.offsetWidth * ratio;
                    canvas.height = canvas.offsetHeight * ratio;
                    canvas.getContext('2d').scale(ratio, ratio);
                });
            }
            
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();
            
            window.clearSignature = function(canvasId) {
                if (canvasId === 'customerSignature') {
                    customerSigPad.clear();
                } else {
                    engineerSigPad.clear();
                }
            };
            
            window.enableNextButton = function() {
                const nextBtn = document.getElementById('nextButton');
                nextBtn.disabled = false;
                nextBtn.onclick = function() {
                    const form = document.getElementById('commissioningForm');
                    const params = new URLSearchParams();
                    params.append('entry.123456', form.companyName.value);
                    params.append('entry.654321', form.invoiceNo.value);
                    // Add more fields as needed
                    
                    window.location.href = `https://docs.google.com/forms/d/e/1FAIpQLSesDslPfVRM9env0JJo91s5Qf9jWZIsdrEjiHXLHdZBLygsag/viewform?${params.toString()}`;
                };
            };
        });
    </script>
</body>
</html>